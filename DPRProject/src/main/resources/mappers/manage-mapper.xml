<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="manageSQL">

	<update id="insertProduct" parameterType="Product">
		UPDATE PRODUCT_DETAIL SET CATEGORYNO2 = #{categoryNo2}, SELLERID = #{sellerId}, PRODUCTNAME = #{productName},
												PRODUCTSTATUS = 'Y', PRODUCTINFO = #{productInfo},
												PRODUCTSTARTDATE = #{productStartdate}, PRODUCTENDDATE = #{productEnddate},
												PRODUCTCONTENT = #{productContent}, PRODUCTCOUNT = 0, PRODUCTPRICE = #{productPrice}, PRODUCTBRAND = #{productBrand}
		WHERE PRODUCTNO = #{productNo}
	</update>
	
	<insert id="insertImage" parameterType="ProductImage">
		<!-- 이미 컨트롤러에서 지정 
		<selectKey keyProperty="productNo" resultType="_int" order="BEFORE">
			SELECT SEQ_BOARDNO.CURRVAL FROM DUAL		
		</selectKey> 
		-->
		INSERT INTO PRODUCTIMAGE VALUES( SEQ_PRODUCTIMAGENO.NEXTVAL, #{productNo}, #{imageCategoryNo},
										 #{productOldImage}, #{productNewImage} )
	</insert>
	
	<insert id="insertTempProduct">
		INSERT INTO PRODUCT_DETAIL VALUES( SEQ_PRODUCT.NEXTVAL, NULL, #{sellerId}, NULL, NULL, NULL, 'Y', NULL,
										   NULL, NULL, NULL, NULL, NULL)
	</insert>
	
	<select id="selectTempProduct" resultType="int">
		SELECT nvl(MAX(PRODUCTNO), 1) FROM PRODUCT_DETAIL
	</select>
	
	<insert id="insertOption" parameterType="Product">
		INSERT INTO PRODUCT_OPTION VALUES( SEQ_OPTIONNO.NEXTVAL, #{productNo}, #{sizeId}, #{productAmount}, 'Y')
	</insert>
	
	<select id="selectProductList" parameterType="string" resultType="Product">
		SELECT DETAIL.*,
			   (SELECT COUNT(*) FROM PRODUCT_OPTION WHERE PRODUCTNO = DETAIL.PRODUCTNO) OPTIONCOUNT,
			   (SELECT PRODUCTNEWIMAGE FROM PRODUCTIMAGE WHERE PRODUCTNO = DETAIL.PRODUCTNO AND IMAGECATEGORYNO = 0) MAINIMAGE,
			   (SELECT CATEGORYNAME || ' > ' || CATEGORYNAME2 FROM "CATEGORY" C1 
			    INNER JOIN "CATEGORY2" C2 ON C1.CATEGORYNO = C2.CATEGROYNO 
			    WHERE C2.CATEGORYNO2 = DETAIL.CATEGORYNO2) CATEGORYNAME		   
		FROM PRODUCT_DETAIL DETAIL
		WHERE SELLERID = #{sellerId}
		ORDER BY PRODUCTNO DESC
	</select>
	
	<select id="selectTotalProduct" parameterType="string" resultType="int">
		SELECT COUNT(*) FROM PRODUCT_DETAIL WHERE SELLERID = #{sellerId}
	</select>
	
	<!--get  reviewList , yongjoo -->
	<select id="selectReviewList" parameterType="string" resultType="Review">
		SELECT *
		FROM REVIEW
		WHERE DETAILNO IN (SELECT DETAILNO
        						       FROM ORDERDETAIL
                  					   WHERE PRODUCTNO IN (SELECT PRODUCTNO
                                     									   FROM PRODUCT_DETAIL
                                     									   WHERE SELLERID = #{sellerId})) 
		ORDER BY REVIEWNO DESC
	</select>
	
	<select id="selectRproduct" parameterType="int" resultType="Product">
		SELECT *
		FROM PRODUCT_DETAIL
		WHERE PRODUCTNO = (SELECT PRODUCTNO
						                   FROM ORDERDETAIL
						                   WHERE DETAILNO = (select DETAILNO
									                                    FROM REVIEW
									                                    WHERE REVIEWNO = #{reviewNo}))
	</select>
	
</mapper>
